# 代码文件使用说明

## 📁 文件结构

本项目按照5周开发计划，将代码文件分别存放在对应的周次文件夹中：

```
Week1/代码/          # 第1周：基础框架与用户系统
Week2/代码/          # 第2周：报销申请功能
Week3/代码/          # 第3周：审核与导出功能
Week4/代码/          # 第4周：云端部署（配置文件）
Week5/代码/          # 第5周：生产环境优化（配置文件）
```

## 🎯 使用方式

### 方式一：按周次逐步开发（推荐）

1. **第1周**：将 `Week1/代码/` 中的文件复制到项目根目录对应位置
   - `users/` 文件夹 → 项目根目录 `users/`
   - `reimbursement_system/` 文件夹 → 项目根目录 `reimbursement_system/`
   - `create_admin.py` → 项目根目录
   - `requirements.txt` → 项目根目录

2. **第2周**：将 `Week2/代码/claims/` 中的文件复制到项目根目录 `claims/` 文件夹

3. **第3周**：更新 `claims/views.py` 和 `claims/urls.py`，添加审核和导出功能

4. **第4-5周**：参考配置文件进行部署和优化

### 方式二：一次性使用所有代码

如果您想一次性查看所有代码，可以直接将各周次的代码文件复制到项目对应位置。

## 📝 各周代码说明

### 第1周：基础框架与用户系统

**核心文件：**
- `users/models.py` - 用户模型（角色、学号、部门）
- `users/forms.py` - 注册表单、个人信息编辑表单
- `users/views.py` - 注册、登录、个人信息管理、用户管理
- `reimbursement_system/settings.py` - Django项目配置（MySQL数据库）
- `reimbursement_system/urls.py` - URL路由配置

**功能：**
- ✅ 用户注册（默认角色为普通用户）
- ✅ 用户登录/登出
- ✅ 个人信息查看和编辑
- ✅ 密码修改
- ✅ 管理员用户管理
- ✅ 角色分配

### 第2周：报销申请功能

**核心文件：**
- `claims/models.py` - 报销单、明细、发票模型
- `claims/forms.py` - 报销表单、明细表单集、发票上传表单
- `claims/views.py` - 创建、编辑、查看报销单
- `claims/urls.py` - 报销应用URL路由

**功能：**
- ✅ 创建报销单（活动主题、描述）
- ✅ 添加多个物品明细（名称、数量、单价）
- ✅ 金额自动计算（数量×单价）
- ✅ 多文件发票上传
- ✅ 暂存功能（保存为草稿）
- ✅ 编辑草稿或已驳回的报销单
- ✅ 查看报销单详情

### 第3周：审核与导出功能

**核心文件：**
- `claims/views.py` - 审核和导出视图（新增）
- `claims/urls.py` - 审核和导出路由（新增）

**功能：**
- ✅ 负责人审核报销单（通过/驳回）
- ✅ 审核备注填写
- ✅ Excel汇总表导出
- ✅ Word活动说明导出
- ✅ 发票批量打包下载
- ✅ 驳回后修改功能

### 第4周：云端部署

**核心文件：**
- `deploy.sh` - 自动化部署脚本
- `run_server.sh` - 服务器启动脚本
- 配置文件示例

**功能：**
- ✅ 服务器环境配置
- ✅ Gunicorn配置
- ✅ Nginx配置
- ✅ MySQL数据库配置
- ✅ 自动化部署流程

### 第5周：生产环境优化

**核心文件：**
- 生产环境配置
- 日志配置
- 监控脚本

**功能：**
- ✅ 生产环境优化
- ✅ 日志系统配置
- ✅ 性能优化
- ✅ 监控和备份
- ✅ 安全加固

## 🚀 快速开始

### 1. 初始化项目（第1周）

```bash
# 1. 创建Django项目（如果还没有）
django-admin startproject reimbursement_system

# 2. 创建应用
python manage.py startapp users
python manage.py startapp claims

# 3. 复制Week1代码文件到对应位置

# 4. 安装依赖
pip install -r requirements.txt

# 5. 配置MySQL数据库（参考MySQL配置说明.md）

# 6. 运行数据库迁移
python manage.py makemigrations users
python manage.py migrate

# 7. 创建管理员账户
python create_admin.py

# 8. 启动开发服务器
python manage.py runserver
```

### 2. 添加报销功能（第2周）

```bash
# 1. 复制Week2代码文件到对应位置

# 2. 运行数据库迁移
python manage.py makemigrations claims
python manage.py migrate

# 3. 重启服务器
python manage.py runserver
```

### 3. 添加审核导出功能（第3周）

```bash
# 1. 复制Week3代码文件到对应位置（更新views.py和urls.py）

# 2. 确保已安装导出依赖
pip install openpyxl python-docx

# 3. 重启服务器
python manage.py runserver
```

## ⚠️ 注意事项

1. **数据库配置**：确保MySQL数据库已正确配置，参考 `MySQL配置说明.md`

2. **文件路径**：复制代码文件时，注意保持正确的目录结构

3. **依赖安装**：每添加新功能时，检查是否需要安装新的依赖包

4. **数据库迁移**：每次修改模型后，需要运行 `makemigrations` 和 `migrate`

5. **权限设置**：确保 `media/` 文件夹有写入权限（用于存储上传的发票文件）

## 📚 相关文档

- `Week1/第1周工作计划.md` - 第1周详细工作计划
- `Week2/第2周工作计划.md` - 第2周详细工作计划
- `Week3/第3周工作计划.md` - 第3周详细工作计划
- `Week4/第4周工作计划.md` - 第4周详细工作计划
- `Week5/第5周工作计划.md` - 第5周详细工作计划
- `MySQL配置说明.md` - MySQL数据库配置指南
- `云服务器部署指南.md` - 云端部署详细指南

## ✅ 验收清单

### 第1周验收
- [ ] 可以注册新用户
- [ ] 可以登录和登出
- [ ] 可以修改个人信息
- [ ] 管理员可以查看用户列表并分配角色

### 第2周验收
- [ ] 可以创建报销单
- [ ] 可以添加多个物品明细
- [ ] 金额自动计算正确
- [ ] 可以上传多个发票文件
- [ ] 可以暂存报销单
- [ ] 可以编辑草稿或已驳回的报销单

### 第3周验收
- [ ] 负责人可以审核报销单
- [ ] 可以标记为已打包或已驳回
- [ ] 可以导出Excel汇总表
- [ ] 可以导出Word活动说明
- [ ] 可以打包下载发票文件

## 🐛 常见问题

1. **数据库连接失败**
   - 检查MySQL服务是否启动
   - 检查数据库用户名和密码是否正确
   - 检查数据库是否已创建

2. **文件上传失败**
   - 检查 `media/` 文件夹是否存在
   - 检查文件夹权限是否正确

3. **导入错误**
   - 确保所有依赖包已安装
   - 检查Python路径和虚拟环境

4. **模板找不到**
   - 检查 `templates/` 文件夹结构
   - 检查 `settings.py` 中的模板配置

## 📞 技术支持

如有问题，请参考：
- Django官方文档：https://docs.djangoproject.com/
- 项目README.md文件
- 各周工作计划文档


