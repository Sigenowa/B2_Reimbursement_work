# 第3周工作计划：审核与导出功能

## 📅 时间安排
- **开始日期**：第3周周一
- **结束日期**：第3周周日
- **预计工时**：25-30小时

## 🎯 本周目标
1. 实现负责人审核功能
2. 实现报销单状态流转
3. 实现Excel汇总表导出
4. 实现Word活动说明导出
5. 实现发票批量打包下载
6. 实现驳回后修改功能

## 📝 每日任务安排

### 周一：审核功能实现
- [ ] 实现负责人查看本部门报销单
- [ ] 实现审核视图（通过/驳回）
- [ ] 实现审核备注功能
- [ ] 创建审核界面模板
- [ ] 测试审核流程

### 周二：状态管理
- [ ] 实现状态流转逻辑
- [ ] 实现批量状态更新
- [ ] 更新状态显示
- [ ] 实现状态变更通知（可选）
- [ ] 测试状态管理

### 周三：Excel导出功能
- [ ] 安装openpyxl库
- [ ] 实现Excel生成逻辑
- [ ] 实现汇总表导出视图
- [ ] 测试Excel导出功能
- [ ] 优化Excel格式

### 周四：Word导出和打包
- [ ] 安装python-docx库
- [ ] 实现Word文档生成
- [ ] 实现发票打包功能
- [ ] 实现ZIP文件下载
- [ ] 测试导出和打包

### 周五：驳回修改功能
- [ ] 实现驳回后编辑功能
- [ ] 更新编辑视图权限
- [ ] 在详情页添加修改按钮
- [ ] 测试驳回修改流程
- [ ] 完善用户体验

### 周末：完善和测试
- [ ] 功能整合测试
- [ ] 导出功能优化
- [ ] 界面优化
- [ ] Bug修复

## 📦 本周新增/更新文件清单

### 1. 更新views.py

#### claims/views.py（新增功能）
```python
- review_reimbursement（审核报销单）
- export_claims（导出报销单）
- edit_reimbursement（编辑报销单，支持驳回后修改）
```

### 2. 更新模板文件

#### templates/dashboard.html
- 负责人视图：显示待审核报销单列表
- 添加导出按钮

#### templates/claims/reimbursement_detail.html
- 添加审核操作区域（负责人可见）
- 添加修改按钮（申请人可见，仅草稿/已驳回状态）
- 显示审核意见

### 3. 更新URL配置

#### claims/urls.py
```python
- review/<int:pk>/（审核路由）
- export/（导出路由）
- edit/<int:pk>/（编辑路由）
```

### 4. 更新requirements.txt
```txt
openpyxl  # Excel导出
python-docx  # Word导出
```

## ✅ 验收标准

### 功能验收
- [ ] 负责人可以查看本部门所有报销单
- [ ] 负责人可以审核报销单（通过/驳回）
- [ ] 负责人可以填写审核备注
- [ ] 可以导出Excel汇总表
- [ ] 可以导出Word活动说明
- [ ] 可以打包下载所有发票
- [ ] 已驳回的报销单可以修改并重新提交

### 技术验收
- [ ] Excel格式正确，包含所有必要字段
- [ ] Word文档格式正确
- [ ] ZIP文件结构清晰（按报销单分类）
- [ ] 状态流转逻辑正确
- [ ] 权限控制正确

### 测试验收
- [ ] 审核流程测试通过
- [ ] 导出功能测试通过
- [ ] 文件打包测试通过
- [ ] 驳回修改流程测试通过

## 🐛 可能遇到的问题

1. **Excel生成性能**
   - 解决：使用openpyxl的优化方法，批量写入

2. **Word文档格式**
   - 解决：使用python-docx的样式功能

3. **文件打包内存占用**
   - 解决：使用流式处理，避免一次性加载所有文件

4. **状态流转逻辑复杂**
   - 解决：使用状态机模式，明确状态转换规则

## 🎯 下周预告

第3.5周将进行功能完善和本地测试，包括：
- 界面优化
- Bug修复
- 完整功能测试
- 文档编写


