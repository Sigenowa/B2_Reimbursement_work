# 📅 第5周工作计划 - 服务器部署版本

## 📋 本周目标

将报销神表系统部署到云服务器，实现公网访问，支持多用户同时使用。

## 🎯 服务器信息

| 配置项 | 值 |
|--------|-----|
| **服务器IP** | 101.43.149.245 |
| **用户名** | ubuntu |
| **操作系统** | Ubuntu |
| **公网访问** | http://101.43.149.245 |

## ✅ 完成的工作

### 1. 代码适配服务器环境

- [x] 修改 `settings.py` 支持服务器部署
  - 添加服务器IP到 `ALLOWED_HOSTS`
  - 配置 `CSRF_TRUSTED_ORIGINS`
  - 添加 WhiteNoise 静态文件中间件
  - 配置 MySQL 数据库连接
  - 添加日志配置

- [x] 创建完整的前端模板
  - `base.html` - 基础模板
  - `dashboard.html` - 仪表盘
  - `reimbursement_form.html` - 报销单表单
  - `reimbursement_detail.html` - 报销单详情
  - 用户相关模板（登录、注册、个人信息、用户管理）

### 2. 创建部署配置

- [x] `deploy/nginx.conf` - Nginx反向代理配置
- [x] `deploy/reimbursement.service` - systemd服务文件
- [x] `deploy/deploy.sh` - 自动部署脚本
- [x] `deploy/quick_start.sh` - 快速启动脚本
- [x] `deploy/mysql_setup.sql` - 数据库初始化SQL
- [x] `gunicorn.conf.py` - Gunicorn配置

### 3. 创建部署文档

- [x] `服务器部署指南.md` - 详细部署步骤
- [x] `README.md` - 项目说明

## 📂 目录结构

```
Week5/
├── 代码/
│   ├── claims/              # 报销管理应用
│   ├── users/               # 用户管理应用
│   ├── reimbursement_system/# 项目配置
│   ├── templates/           # 前端模板
│   ├── static/              # 静态文件
│   ├── deploy/              # 部署配置
│   │   ├── nginx.conf
│   │   ├── reimbursement.service
│   │   ├── deploy.sh
│   │   ├── quick_start.sh
│   │   └── mysql_setup.sql
│   ├── manage.py
│   ├── requirements.txt
│   ├── gunicorn.conf.py
│   ├── create_admin.py
│   ├── 服务器部署指南.md
│   └── README.md
└── 第5周工作计划.md
```

## 🚀 部署方式

### 方式一：自动部署

```bash
ssh ubuntu@101.43.149.245
cd /home/ubuntu/reimbursement
bash deploy/deploy.sh
```

### 方式二：手动部署

1. 上传代码到服务器
2. 安装系统依赖（Python、MySQL、Nginx）
3. 配置数据库
4. 配置环境变量
5. 运行迁移
6. 配置Nginx和systemd
7. 启动服务

## 📊 与Week4的区别

| 功能 | Week4 | Week5 |
|------|-------|-------|
| 部署方式 | 本地运行 | 服务器部署 |
| 数据库 | SQLite | MySQL |
| Web服务器 | Django开发服务器 | Nginx + Gunicorn |
| 访问方式 | 本地/局域网 | 公网访问 |
| 进程管理 | 手动运行 | systemd服务 |
| 静态文件 | Django提供 | WhiteNoise + Nginx |

## 🔍 技术要点

1. **Gunicorn**：生产级WSGI服务器，多进程处理请求
2. **Nginx**：反向代理，静态文件服务，负载均衡
3. **systemd**：进程管理，开机自启，自动重启
4. **WhiteNoise**：高效的静态文件服务中间件
5. **MySQL**：生产级关系型数据库

## 📌 注意事项

1. 首次部署需要创建管理员账户
2. 生产环境必须设置 `DEBUG=False`
3. 必须修改 `SECRET_KEY` 为随机值
4. 数据库密码需要设置为强密码
5. 建议配置SSL证书启用HTTPS

---

**完成日期**: 2025年1月  
**下一步**: 功能优化和安全加固
